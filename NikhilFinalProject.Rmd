------
title: "Project final model "
author: "Priya Gummadi"
Project Partner :"Nikhil chandragiri"
date: "4/23/2019"
output: XLS file 
------

```{r}
Pdata<-read.csv("Drug_Poisoning_Mortality.csv",TRUE,",")
Pdata<-data.frame(Pdata)
Pdata<-Pdata[1:2000,1:18]
mydata<-data.frame(na.omit(Pdata))
mydata
str(mydata)
################
ggplot(mydata,aes(x=Crude.Death.Rate,y=Deaths))+geom_point()+geom_smooth(method=lm,se=FALSE,colour="black")
val<-lm(Deaths~Crude.Death.Rate,data=mydata)
coef(val)
summary(val)
mydata$predictedVal<-predict(val)
mydata$residualVal<-residuals(val)
#plotting  linear regression and residual values 
ggplot(mydata,aes(x=Crude.Death.Rate,y=Deaths))+geom_smooth(method=lm,se=FALSE,color="grey")+geom_segment(aes(xend=Crude.Death.Rate,yend=predictedVal),alpha=0.2)+geom_point(aes(color=abs(residualVal)))+scale_color_continuous(low="orange",high="green")+guides(color=FALSE)+geom_point(aes(y=predictedVal),shape=1)
theme_bw()
#################
#ggplot(mydata,aes(x= Lower.Confidence.Limit.for.Crude.Rate,y=Deaths))+geom_point()+geom_smooth(method=lm,se=FALSE,colour="black")
val1<-lm(Deaths~Lower.Confidence.Limit.for.Crude.Rate,data=mydata)
val1$fit
val1$coeff

x1<-mydata$Lower.Confidence.Limit.for.Crude.Rate
new_x1<-cbind(x1,x1^2)
new_x1

val12<-lm(Deaths~new_x1,data=mydata)
val12$fit
val12$coeff

ggplot(data=mydata)+geom_point(aes(x=x1,y=Deaths))+
geom_line(aes(x=x1,y=val1$fit),color="red")+
geom_line(aes(x=x1,y=val12$fit),color="blue")+
theme(panel.background=element_blank())
mydata$predictedVal12<-predict(val12)
mydata$residualVal12<-residuals(val12)
 
ggplot(mydata,aes(x= Lower.Confidence.Limit.for.Crude.Rate,y=Deaths))+geom_smooth(method=lm,se=FALSE,color="grey")+geom_segment(aes(xend= Lower.Confidence.Limit.for.Crude.Rate,yend=predictedVal12),alpha=0.2)+geom_point(aes(color=abs(residualVal12)))+scale_color_continuous(low="orange",high="green")+guides(color=FALSE)+geom_point(aes(y=predictedVal12),shape=1)
theme_bw()
################
#ggplot(mydata,aes(x= Upper.Confidence.Limit.for.Crude.Rate,y=Deaths))+geom_point()+geom_smooth(method=lm,se=FALSE,colour="black")

model<-rq(Deaths~Upper.Confidence.Limit.for.Crude.Rate,data=mydata,tau=0.25)
summary(model)

model1<-rq(Deaths~Upper.Confidence.Limit.for.Crude.Rate,data=mydata,tau=seq(0.05,0.95,by=0.05))
quantplot<-summary(model1)
quantplot
plot(quantplot)

mydata$predictedval2<-predict(model)
mydata$residualsval2<-residuals(model)
#val2<-lm(Deaths~Upper.Confidence.Limit.for.Crude.Rate,data=mydata)

#plotting  linear regression and residual values 
ggplot(mydata,aes(x= Upper.Confidence.Limit.for.Crude.Rate,y=Deaths))+geom_smooth(method=lm,se=FALSE,color="grey")+geom_segment(aes(xend= Upper.Confidence.Limit.for.Crude.Rate,yend=predictedval2),alpha=0.2)+geom_point(aes(color=abs(residualsval2)))+scale_color_continuous(low="orange",high="green")+guides(color=FALSE)+geom_point(aes(y=predictedval2),shape=1)
theme_bw()

```

